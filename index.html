<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Auto Video Editor</title>
<style>
body { font-family: Arial; margin:20px; }
.grid { display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px; }
video { width:100%; border-radius:8px; }
button { padding:10px 20px; background:#2563eb; color:white; border:none; border-radius:8px; cursor:pointer; }
button:disabled { background:gray; cursor:not-allowed; }
pre { background:#f3f3f3; padding:10px; border-radius:6px; max-height:300px; overflow-y:auto; }
</style>
</head>
<body>

<h1>Auto Video Editor</h1>
<input type="file" id="fileInput" multiple accept="video/*"><br><br>
<div id="preview" class="grid"></div>
<button id="analyzeBtn">Upload & Analyze</button>
<div id="results"></div>

<script>
const fileInput = document.getElementById('fileInput');
const previewDiv = document.getElementById('preview');
const analyzeBtn = document.getElementById('analyzeBtn');
const resultsDiv = document.getElementById('results');
let files = [];

fileInput.addEventListener('change', e => {
    files = Array.from(e.target.files);
    previewDiv.innerHTML = '';
    files.forEach(f => {
        const url = URL.createObjectURL(f);
        const video = document.createElement('video');
        video.src = url;
        video.controls = true;
        previewDiv.appendChild(video);
    });
});

analyzeBtn.addEventListener('click', async () => {
    if (files.length < 4) { alert("Upload at least 4 clips."); return; }

    analyzeBtn.disabled = true; analyzeBtn.textContent = "Uploading & Analyzing...";
    const fd = new FormData();
    files.forEach(f => fd.append('clips', f));

    try {
        const res = await fetch('https://localhost:5001/api/VideoUpload/upload', { method:'POST', body:fd });
        if(!res.ok) throw new Error(await res.text());
        const json = await res.json();

        resultsDiv.innerHTML = `<h2>Results</h2><pre>${JSON.stringify(json,null,2)}</pre>`;

        // Show saved videos from backend
        previewDiv.innerHTML = '';
        json.files.forEach(f => {
            const video = document.createElement('video');
            video.src = `/VideoClips/${f}`;
            video.controls = true;
            previewDiv.appendChild(video);
        });

    } catch(err) { alert("Error: "+err.message); }
    finally { analyzeBtn.disabled=false; analyzeBtn.textContent="Upload & Analyze"; }
});
</script>

</body>
</html>
